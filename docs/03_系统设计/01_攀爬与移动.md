# 梦山 系统设计规范 — 攀爬与移动 (Climbing & Movement Spec)

> **设计目的 (Design Goal)**  
> 定义角色地面行走、奔跑、攀爬等基础移动规则，以及体力消耗与恢复逻辑；与《协作与救援》《状态系统》共同构成攀爬协作体验。
> **设计支柱引用**: [互助即玩法](../00_项目核心/02_Pillars_设计支柱.md)
> **关联文档**: [协作与救援](02_协作与救援.md)、[状态系统](04_状态系统.md)、[道具系统](05_道具系统.md)
> **更新日期**: 2026-02-11

---

## 1. 挑战模型 (Challenge Model)

### 1.1 阻力来源 (Resistance)
*   **操作精度**: 攀爬需要精准的支点选择与借力时机。
*   **体力管理**: 奔跑与攀爬消耗体力，需在路线与节奏上权衡。

### 1.2 核心动词 (Core Verb)
*   **行走 (Walk)**: 地面基础移动。
*   **奔跑 (Run)**: 按住 Shift 加速，消耗体力。
*   **攀爬 (Climb)**: 抓取支点、位移、借力（待细化）。

---

## 2. 体验循环 (Experience Loop)

*   **观察**: 关注支点分布、体力条状态。
*   **决策**: 何时奔跑、何时节省体力。
*   **行动**: WASD 移动、Shift 奔跑、鼠标控制视角。
*   **反馈**: 位移、体力消耗与恢复、力竭时的速度惩罚。

---

## 3. 验证准则 (Validation Heuristics)

*   **策略空间**: 熟练玩家能通过体力节奏优化路线。
*   **重玩价值**: 路线预判与体力分配影响通关效率。

---

## 4. 执行细则 (Execution Details)

### 4.1 地面移动原子操作 (Atomic Actions)

| 操作名称 | 触发方式 | 前置条件 | 结果 |
| :--- | :--- | :--- | :--- |
| 行走 | WASD 持续输入 | 无 | 以 MOVE_SPEED 位移 |
| 奔跑 | Shift 按住 | 体力 > 0 | 以 RUN_SPEED 位移，消耗体力 |
| 停止奔跑 | Shift 松开 / 体力耗尽 | 奔跑中 | 恢复行走速度，体力可恢复 |

### 4.2 奔跑与体力消耗规则

*   **进入奔跑**：首帧立即扣除一次 `STAMINA_COST_RUN_PER_SEC`（策划 4.3 规定）。
*   **持续消耗**：奔跑且 `Velocity.Size() > 0` 时，按 `DeltaTime` 比例扣除 `STAMINA_COST_RUN_PER_SEC`；不足 1 秒时按比例结算。
*   **力竭**：当 `CurrentStamina <= 0` 时，强制停止奔跑，速度重置为 MOVE_SPEED。
*   **恢复**：静止或行走时每秒恢复固定值（由 CA 表配置，可预留 `GetEncumbranceModifier()` 接口）。

### 4.3 角色基础移动与体力常量（CA 表）

| 常量名 | 类型 | 含义 | 备注示例 |
| :--- | :--- | :--- | :--- |
| MOVE_SPEED | float | 地面行走速度 (UE 单位/s) | 如 350 (约 3.5 m/s) |
| RUN_SPEED | float | 地面奔跑速度 (UE 单位/s) | 如 550 (约 5.5 m/s) |
| STAMINA_MAX | float | 体力上限 | 如 100 |
| STAMINA_COST_RUN_PER_SEC | float | 奔跑每秒消耗（点/秒） | 策划配置，如 15 |
| STAMINA_RECOVER_PER_SEC | float | 静止/行走时每秒恢复 | 如 5.0，可扩展负重修正 |

> **奔跑结算说明**：首帧立即扣一次 `STAMINA_COST_RUN_PER_SEC`，之后按秒结算；不足 1 秒时按 `DeltaTime` 比例结算。

---

## 5. 攀爬（待扩展）

*   抓取支点、位移、借力、失败重试等细则待《攀爬与移动》后续版本细化。
*   攀爬体力消耗与 Action_Bar 对接见《状态系统》。

---

## 6. 技术对接 (Technical Mapping)

### 6.1 常量 ↔ UE 对照

| 策划常量 | UE 实现 |
| :--- | :--- |
| MOVE_SPEED | `CharacterMovement->MaxWalkSpeed`（行走时） |
| RUN_SPEED | `CharacterMovement->MaxWalkSpeed`（奔跑时） |
| STAMINA_MAX | 角色 `MaxStamina` 或 CA 表读取 |
| CurrentStamina | 角色 `CurrentStamina` 变量 |
| STAMINA_COST_RUN_PER_SEC | Tick / 计时器中按秒结算，StartRun 时首帧扣一次 |
| GetEncumbranceModifier() | 预留接口，暂返回 1.0，负重系统接入后修正体力恢复 |

---

## 7. 接口矩阵 (Interface Matrix)

| 系统 | 接口 / 依赖 |
| :--- | :--- |
| [SYS_STATE] 状态系统 | Action_Bar、STAMINA_MAX、体力占段 |
| [SYS_PROPS] 道具系统 | 负重影响 GetEncumbranceModifier() |
| [SYS_CLIMB] 攀爬与移动 | 借力、支点判定（待扩展） |
