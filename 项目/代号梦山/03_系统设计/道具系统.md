# 梦山 系统设计规范 — 道具系统（利他背包）(Item & Backpack System Spec)

> **设计目的 (Design Goal)**
> *   **体验目标**: 通过「背负代价 + 队友可代为取用」的背包设计，强化利他协作与资源共担，与 [Aes: Belonging] 及攀爬协作体验一致。
> *   **功能目标**: 管理玩家携带道具、负重对体力的占用、以及「谁可以从谁身上取物」的权限与交互。
> **设计支柱引用**: [互助即玩法](../00_项目核心/02_Pillars_设计支柱.md)
> **关联文档**: [关系系统](系统设计规范_关系系统.md)（道具使用的关系门控）、[核心玩法规范_攀爬与协作](核心玩法规范_攀爬与协作.md)（体力槽 Action_Bar、互助行为中的道具相关条目）
> **更新日期**: 2026-02-09

---

## 1. 道具与负重占段 (Items & Weight Segments)

> **说明**：体力条 (Action_Bar)、各类状态占段及「可用体力」计算的完整规则已在《状态系统》中定义。本节仅说明**道具如何通过重量影响 Weight_Penalty 占段**，以及与状态系统的对接方式。

### 1.1 Weight_Penalty 与道具重量

*   每个道具配置一个 **重量 (Weight)** 字段，用于计算负重占段 `Weight_Penalty`。
*   负重占段通过如下方式与状态系统对接：
    * 状态系统维护 `weightPenalty` 数值，并参与 Action_Bar 可用体力计算。
    * 道具系统在**背包/物品栏发生变化**时，重新计算所有已携带道具重量之和，并将结果同步为 `weightPenalty`。\n+*   示例：体力上限 `STAMINA_MAX = 100`，总重量映射为 `weightPenalty = 30` 时，则有 30 点体力槽以负重颜色显示，不可用于奔跑/攀爬等消耗体力的行为；当丢弃物品后，`weightPenalty` 降低，可用体力随之恢复。

### 1.2 与其他占段的关系

*   环境挫折（冰冻、中毒、受伤等）所占用的体力槽段由《状态系统》与关卡/环境系统管理，本规范不再重复定义。
*   道具系统只需保证：\n+    * 对应的「解状态」道具在使用时，调用状态系统接口，减少相应占段（如解除中毒、寒冷、受伤等）。\n+    * 不直接修改「生存状态」（存活/待救援/死亡），而是通过改变各类占段间接影响生存风险（复活类道具除外）。

---

## 2. 交互权限：单向提取规则 (One-Way Extraction)

### 2.1 栏位与输入映射

| 栏位 | 数量 | 输入 | 说明 |
| :--- | :--- | :--- | :--- |
| **物品栏 (Action_Bar Slots)** | 3 个 | 数字键 1 / 2 / 3 或虚拟图标 | 可直接使用的快捷栏位，选中后「取在手上」 |
| **背包栏 (Backpack Slot)** | 1 个 | 数字键 4 或虚拟「背包」图标 | 选中后视为「手持背包」；背包内可存放**额外 4 个道具**，所有道具重量**不会因放入背包而减轻**，仍计入背负者总负重 |

*   **取在手上**：按 1–4 将对应物品/背包取在手上，并**高亮选中**该栏位。手持状态下，左键对自身使用道具；右键将道具**放回**对应栏位（取消高亮选中）。

### 2.2 使用、放入与丢弃（防误触）

| 操作 | 输入 | 前置条件 | 说明 |
| :--- | :--- | :--- | :--- |
| 对目标使用 / 放入他人背包 | **长按 E** | 手上有道具，且面向有效目标（其他玩家、他人背包等） | 有匹配目标时提示「长按 E 使用道具」或「长按 E 放入背包」；长按时间参数用于防止误操作，具体数值见 CA 表 |
| 丢弃在地上 | **长按 Q** | 手上有道具或背包 | 将当前手持物品/背包丢弃到地面；长按时间与「放下」区分，避免误触（见 2.4 与 PEAK 借鉴） |

### 2.3 禁止自用 (Self-Use Restricted)

*   **背负者拥有背包所有权**，但**禁止**触发「从自己背上取物」的动作。
*   背负者若需取用背包内物品，必须**先将背包丢弃在地上**，然后走到背包旁，从其中取出对应道具并持在手上（即：自用流程 = 放下背包 → 从地面上的背包中取物）。

### 2.4 他者触发 (Peer Interaction)

*   **非背负者的队友**可以直接对背负者触发 **Take_Item**：靠近背负者并执行交互（如长按 E），打开对方**背上的背包**界面，从中取出道具拿在手上，或将手中道具放入对方背包。
*   关系门控：对「谁可以从谁背包取物」的限制见 [关系系统](系统设计规范_关系系统.md) 与 [核心玩法规范 4.3 互助行为](核心玩法规范_攀爬与协作.md#43-互助行为定义-cooperation-actions-definition)（如陌生人是否可访问背包可由项目统一规定；建议至少为「邂逅者」以上可触发 Take_Item）。

### 2.5 非言语共识 (Non-verbal Solidarity)

*   当**队友从背负者背包中取走道具**时，背负者 **Agent 自动播放一次「减轻负担」类反馈动画**（如松一口气、肩部微调等），强化「别人帮我减负」的共情与利他感知，无需额外语音沟通。

---

## 3. 道具分级方案 (Progressive Unlocking)

| 阶段 | 开放内容 | 设计意图 |
| :--- | :--- | :--- |
| **新手期** | 保持低复杂度，仅开放**基础回复道具**（如体力回复、简单治疗） | 先建立「背包装什么、负重占体力」的心智模型，避免过早引入状态与解状态 |
| **进阶期** | 开放具有**环境对抗性**的道具（如抗冻剂、解毒药、热包等） | 与 Action_Bar 上的环境挫折占段配合，形成「带对药、互相帮忙取用」的协作深度 |

---

## 4. 基础道具规则（参考 PEAK，可后续调整）

> 以下规则借鉴合作登山游戏 **PEAK** 的背包与道具使用方式，作为本项目的**基础实现参考**；具体数值与交互细节可在 Demo 中调整。

### 4.1 背包的「放下」与「投掷」区分

*   **短按 Q（或单独映射「放下」键）**：将背包**轻轻放在当前脚下**，不施加初速度，适合在安全平台整理物品。
*   **长按 Q**：将背包（或手中道具）**投掷出去**，存在掉下悬崖等风险，用于快速减负或传递到队友附近。
*   实现时可通过**长按时间参数**区分「放下」与「投掷」，防止误操作。

### 4.2 访问自己背包的方式

*   与 2.3 一致：**必须先放下背包**，再走到地面上的背包旁，通过交互键（如 E）打开背包界面，选择物品取到手上。不支持「从自己背上直接掏包」。

### 4.3 访问队友背包的方式

*   与 2.4 一致：**直接靠近背负者，长按 E**，即可打开对方**背上的背包**，取物或放入物品，无需对方先放下背包。便于在狭窄地形快速共享资源。

### 4.4 物品放入背包的时机

*   当前约定：**仅当背包处于地面**时，可将手中道具放入背包（手持道具 → 走到地面背包旁 → 长按 E 放入）。不支持「背着包时往自己背后塞东西」。
*   若后续希望支持「队友手持道具塞进我背上背包」，可单独扩展为「他者放入」权限，与 Take_Item 对称。

### 4.5 基础道具类别（PEAK 参考，供扩展）

#### 4.5.1 道具类型 ↔ 影响的状态系统字段

| 道具类别 | 典型示例 | 主要影响的状态系统字段 |
| :--- | :--- | :--- |
| 回复类 | 体力药、绷带、食物 | 增加 `staminaCurrent`，或减少 `injurySegment` / `hungerSegment` |
| 环境对抗类 | 抗冻剂、解毒药、热包 | 减少 `coldSegment` / `poisonSegment` 等环境占段 |
| 攀登辅助类 | 绳索、锚点等（若项目启用） | 通常不直接改占段，而是降低单位时间/单位动作体力消耗，间接减少对 `staminaCurrent` 的压力 |
| 复活/求救类 | 复活雕像碎片、求救信号等 | 在特定条件下将 `lifeState` 从 Dead/Downed 拉回 Alive，或延长 `downedTimer` |
| 杂项 | 指南针、情绪/社交道具等 | 主要影响导航/情绪反馈，不直接改状态字段，可选做轻微正向反馈 |

> 具体每个道具的数值效果由数值文档细化；本表仅定义「道具类别 → 会动到状态系统哪些字段」的边界，防止道具系统与状态系统的职责混淆。

#### 4.5.2 道具类别列表（可扩展）

| 类别 | 示例 | 用途 |
| :--- | :--- | :--- |
| 回复类 | 体力药、绷带、食物 | 恢复体力/生命，与 Action_Bar 与生命系统对接 |
| 环境对抗类 | 抗冻剂、解毒药、热包 | 解除环境挫折占段，恢复可用体力 |
| 攀登辅助类 | 绳索、锚点等（若项目启用） | 与攀爬系统配合，见核心玩法规范 |
| 杂项 | 指南针、复活/求救类道具等 | 按项目需求扩展，注意与关系门控一致（如复活类可能需 2 同行者） |

*   每类道具需配置 **重量 (Weight)**，用于计算 Weight_Penalty 占段；**使用方式**（对己/对他）、**关系要求** 与 [核心玩法规范 4.3 互助行为](核心玩法规范_攀爬与协作.md#43-互助行为定义-cooperation-actions-definition) 保持一致。

---

## 5. 常量与配置建议（CA 表）

| 常量名 | 类型 | 单位 | 说明 |
| :--- | :--- | :--- | :--- |
| `ACTION_BAR_SLOT_COUNT` | int | 个 | 物品栏数量，默认 3 |
| `BACKPACK_SLOT_COUNT` | int | 个 | 单背包内格数，默认 4 |
| `WEIGHT_TO_STAMINA_RATIO` | float | 点/kg 或 点/单位重量 | 单位重量占用的体力槽数值，用于 Weight_Penalty 计算 |
| `INTERACT_HOLD_TIME_USE` | float | 秒 | 长按 E 使用/放入的防误触时间 |
| `DROP_HOLD_TIME_THROW` | float | 秒 | 长按 Q 判定为「投掷」的时长；短于该时长视为「放下」 |

---

## 6. 与系统架构的映射

| 系统 | 本规范覆盖 |
| :--- | :--- |
| **[SYS_ITEM]** 道具系统 | 栏位、背包、负重占段、使用/放入/丢弃、Take_Item、道具分级与类别 |
| **[SYS_RELATION]** 关系系统 | 谁可对谁触发 Take_Item、谁可使用「对他人使用道具」与综合功效道具（见核心玩法规范 4.3） |
| **核心玩法 / 体力** | Action_Bar 与攀爬体力共用同一体力槽；负重占段与 STAMINA_MAX 共同决定可用体力 |
| **核心玩法 / 互助行为** | 使用明显无副作用道具、使用综合功效道具、丢弃/放置等与关系门控的对接 |

---

## 7. 小结与后续可调整点

*   **利他背包**：通过「背负者有代价、队友可代为取用」和「减轻负担」反馈，强化协作与归属感。
*   **基础规则**已按 PEAK 的「放下开包、队友直接访问背上背包、Q 短/长按区分放下与投掷」写入；**具体键位、长按时长、负重公式、道具列表**可在实现与 Demo 阶段再调。
*   与**关系系统**、**核心玩法规范**中「使用道具」「放入背包」的关系要求保持一致，避免出现权限冲突。
